<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Memory</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="icon" href="images/favicon.png" type="image/png">
        <link rel="stylesheet" href="css/navbar&footer.css">
        <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Pacifico&display=swap" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    </head>
    <body class="theatre">
        <img src="images/snoopy.png" class="snoopy" alt="snoopy">
        <div class="memory-stage">
            <div id="music-control">
                <div class="music-hint">ğŸµ å…ˆç‚¹æˆ‘å¼€å¯èƒŒæ™¯éŸ³ä¹ â†’</div>
                <button id="toggle-music">â–¶ï¸</button>
                <div id="yt-music-player"></div>
            </div>
            <h1 class="memory-title">å›å¿†</h1>
            <div class="intro-texts">
                <p>æ­£å¦‚æˆ‘æ‰€è¯´è¿‡å¿«ä¹æ— æ³•æ°¸æ’ï¼Œ</p>
                <p>ä½†æ˜¯è®°å¿†ä¸­çš„å¿«ä¹æ˜¯æ°¸æ’çš„ã€‚</p>
                <p>äºæ˜¯æˆ‘é€ä½ çš„ç”Ÿæ—¥ç¤¼ç‰©ä¹‹ä¸€ï¼Œ</p>
                <p>ä¾¿æ˜¯â€”â€”å›å¿†ã€‚</p>
            </div>

            <div class="memory-card-container"></div>

            <div class="all-cards-grid hidden"></div>

            <a href="future.html" class="next-button hidden" id="wish-btn">
                <span>ç‚¹æˆ‘ç‚¹æˆ‘ç‚¹æˆ‘</span>
                <svg class="paper-plane" viewBox="0 0 24 24" width="24" height="24" fill="white">
                    <path d="M2 3l19 9-19 9v-7l13-2-13-2v-7z"/>
                </svg>
            </a>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <p>&copy; 2025 petryiy. All rights reserved.</p>
                <p>Built with ğŸ©· to Adonia.</p>
                <div class="social-icons">
                <a href="https://www.instagram.com/michaelzhang715/" target="_blank" class="social-icon">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="www.linkedin.com/in/ruiqi-zhang-michael" target="_blank" class="social-icon">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="https://github.com/petryiy" target="_blank" class="social-icon">
                    <i class="fab fa-github"></i>
                </a>
                </div>
            </div>
        </footer>

        <script src="scripts/theatre.js"></script>
        <script>
            document.getElementById('wish-btn').addEventListener('click', function(e) {
                e.preventDefault();
                document.body.classList.add('page-folding');
                setTimeout(() => {
                    window.location.href = 'future.html';
                }, 1200);
            });
        </script>
        <script src="https://www.youtube.com/iframe_api"></script>
        <script>
            let player;
            let isPlaying = false;
            let hasUserInteracted = false;
        
            // è·å–æŒ‰é’®å¼•ç”¨
            const toggleMusicBtn = document.getElementById('toggle-music');
        
            // æ›´æ–°æŒ‰é’®å›¾æ ‡çš„å‡½æ•°
            function updateToggleButtonIcon() {
                if (toggleMusicBtn) {
                    // å¦‚æœæ’­æ”¾å™¨å­˜åœ¨ä¸”æ­£åœ¨æ’­æ”¾ä¸”æœªé™éŸ³ï¼Œåˆ™æ˜¾ç¤ºæš‚åœå›¾æ ‡
                    if (player && player.getPlayerState() === YT.PlayerState.PLAYING && !player.isMuted()) {
                        toggleMusicBtn.textContent = 'â¸ï¸'; // æ­£åœ¨æ’­æ”¾ä¸”æœ‰å£°éŸ³
                    } else {
                        toggleMusicBtn.textContent = 'â–¶ï¸'; // æš‚åœã€åœæ­¢æˆ–é™éŸ³
                    }
                }
            }
        
            // ç”¨äºåˆå§‹åŒ– YouTube æ’­æ”¾å™¨çš„å‡½æ•°
            function initializeYouTubePlayerPresent() {
                player = new YT.Player('yt-music-player', {
                    videoId: 'Yh38A0BU22w', //åªä¸ºä½ ç€è¿·
                    playerVars: {
                        autoplay: 1,
                        controls: 0,
                        loop: 1,
                        playlist: 'Yh38A0BU22w',
                        modestbranding: 1,
                        rel: 0
                    },
                    events: {
                        onReady: (event) => {
                            // æ’­æ”¾å™¨å‡†å¤‡å°±ç»ªåï¼Œç«‹å³é™éŸ³æ’­æ”¾å™¨ï¼Œå› ä¸ºæµè§ˆå™¨å¯èƒ½å·²ç»é™éŸ³äº†
                            event.target.mute();
                            isPlaying = false; // åˆå§‹çŠ¶æ€ä¸ºé™éŸ³ï¼Œæ‰€ä»¥è§†ä¸ºæœªæ’­æ”¾
                            updateToggleButtonIcon(); // æ›´æ–°æŒ‰é’®å›¾æ ‡ä¸ºâ€œæ’­æ”¾â€çŠ¶æ€
                            console.log("YouTube Player is ready and muted."); // è°ƒè¯•æ—¥å¿—
                        },
                        onStateChange: (event) => {
                            // æ ¹æ®æ’­æ”¾å™¨å®é™…çŠ¶æ€å’Œé™éŸ³çŠ¶æ€æ›´æ–° isPlaying
                            isPlaying = (event.data === YT.PlayerState.PLAYING && !player.isMuted());
                            updateToggleButtonIcon();
                        }
                    }
                });
            }
        
            // YouTube API ä¼šåœ¨ API å‡†å¤‡å°±ç»ªæ—¶è°ƒç”¨æ­¤å‡½æ•°
            function onYouTubeIframeAPIReady() {
                initializeYouTubePlayerPresent();
            }
        
            // æ£€æŸ¥ YouTube API æ˜¯å¦å·²åŠ è½½ï¼ˆä¾‹å¦‚ï¼Œä»ä¸Šä¸€ä¸ªé¡µé¢åŠ è½½ï¼‰
            // å¦‚æœå·²åŠ è½½ï¼Œåˆ™æ‰‹åŠ¨è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ã€‚
            if (window.YT && window.YT.Player) {
                onYouTubeIframeAPIReady();
            }
        
            // å°†æŒ‰é’®ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ç§»åˆ°è¿™é‡Œï¼Œç¡®ä¿å®ƒåœ¨ DOM åŠ è½½åç«‹å³ç»‘å®š
            if (toggleMusicBtn) {
                toggleMusicBtn.addEventListener('click', () => {
                    // åœ¨æ‰§è¡Œä»»ä½•æ’­æ”¾å™¨æ“ä½œä¹‹å‰ï¼Œæ£€æŸ¥ player å¯¹è±¡æ˜¯å¦å·²å®šä¹‰
                    if (!player) {
                        console.warn("Player not yet initialized. Please wait or refresh.");
                        return; // å¦‚æœæ’­æ”¾å™¨æœªå°±ç»ªï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
                    }
        
                    if (!hasUserInteracted) {
                        // ç¬¬ä¸€æ¬¡äº¤äº’ï¼šå–æ¶ˆé™éŸ³å¹¶æ’­æ”¾
                        player.unMute();
                        player.playVideo();
                        hasUserInteracted = true;
                        isPlaying = true; // ç°åœ¨çœŸæ­£æ’­æ”¾å¹¶æœ‰å£°éŸ³äº†
                        console.log("First user interaction: Unmuted and playing."); // è°ƒè¯•æ—¥å¿—
                    } else {
                        // åç»­äº¤äº’ï¼šåˆ‡æ¢æ’­æ”¾/æš‚åœ
                        if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                            player.pauseVideo();
                            isPlaying = false;
                            console.log("Pausing music."); // è°ƒè¯•æ—¥å¿—
                        } else {
                            player.playVideo();
                            isPlaying = true;
                            console.log("Playing music."); // è°ƒè¯•æ—¥å¿—
                        }
                    }
                    updateToggleButtonIcon(); // äº¤äº’åæ›´æ–°å›¾æ ‡
                });
            }
        </script>
    </body>
</html>