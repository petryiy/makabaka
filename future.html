<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Future</title>
    <link rel="stylesheet" href="css/navbar&footer.css">
    <link rel="icon" href="images/favicon.png" type="image/png">
    <link rel="stylesheet" href="css/future.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="page-content">
      <div id="music-control" style="position: fixed; top: 20px; right: 20px; z-index: 100; text-align: right;">
        <div style="color: #fff; font-size: 0.9rem; margin-bottom: 5px;">
          ğŸ‘‰ å…ˆç‚¹æˆ‘æ’­æ”¾èƒŒæ™¯éŸ³ä¹
        </div>
        <button id="toggle-music" style="background: transparent; border: none; color: white; font-size: 1.5rem; cursor: pointer;">
          ğŸµ
        </button>
      </div>
      
      
      <div id="yt-music-player" style="display: none;"></div>

      <canvas id="stars-canvas"></canvas>
      
      <h1 class="page-title">æ„¿æ™¯</h1>
      <div class="opening-text">
        <p id="line1"></p>
        <p id="line2"></p>
        <p id="line3"></p>
        <p id="line4"></p>
      </div>

      <div id="bottles-container"></div>

      <button id="continue-btn" class="continue-btn hidden">
        ç‚¹å®Œæ‰€æœ‰æ¼‚æµç“¶ç»§ç»­ç‚¹æˆ‘ï¼
        <svg class="wave" viewBox="0 0 1200 100" preserveAspectRatio="none">
          <path 
          d="M0,0 C150,50 350,0 500,50 C650,100 850,0 1000,50 C1150,100 1200,50 1200,0 L1200,100 L0,100 Z"
          fill="rgba(255,255,255,0.2)">
          </path>
        </svg>
      </button>
    </div>

    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2025 petryiy. All rights reserved.</p>
        <p>Built with ğŸ©· to Adonia.</p>
    
        <p style="font-size: 0.75em; color: #ccc;">
          æ¼‚æµç“¶æ’ç”»ç´ ææ¥è‡ªï¼š
          <a href="https://zh.pngtree.com/freepng/fantasy-starry-drift-bottle-illustration_4750553.html" target="_blank" rel="noopener noreferrer">
            pngtree.comï¼ˆå¹»æƒ³æ˜Ÿç©ºæ¼‚æµç“¶æ’å›¾ï¼‰
          </a>
        </p>
    
        <div class="social-icons">
          <a href="https://www.instagram.com/michaelzhang715/" target="_blank" class="social-icon">
            <i class="fab fa-instagram"></i>
          </a>
          <a href="https://www.linkedin.com/in/ruiqi-zhang-michael" target="_blank" class="social-icon">
            <i class="fab fa-linkedin-in"></i>
          </a>
          <a href="https://github.com/petryiy" target="_blank" class="social-icon">
            <i class="fab fa-github"></i>
          </a>
        </div>
      </div>
    </footer>      
      
    <script src="scripts/future.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
      let player;
      let isPlaying = false;
      let hasStartedMusic = false;
      // è·å–æŒ‰é’®å¼•ç”¨ï¼Œç¡®ä¿åœ¨ DOMContentLoaded ä¹‹åå³å¯è®¿é—®
      const toggleBtn = document.getElementById("toggle-music");
  
      // ç”¨äºåˆå§‹åŒ– YouTube æ’­æ”¾å™¨çš„å‡½æ•°
      function initializeYouTubePlayer() {
        player = new YT.Player('yt-music-player', {
          videoId: 'EHy4D0Xhjkg',
          playerVars: {
              autoplay: 1,
              loop: 1,
              controls: 0,
              playlist: 'EHy4D0Xhjkg',
              modestbranding: 1,
              rel: 0
          },
          events: {
            onReady: (event) => {
              // æ’­æ”¾å™¨å‡†å¤‡å°±ç»ªåï¼Œå°è¯•æ’­æ”¾éŸ³ä¹å¹¶è®¾ç½®æŒ‰é’®ç›‘å¬å™¨
              if (!hasStartedMusic) {
                event.target.playVideo();
                event.target.unMute();
                hasStartedMusic = true;
              }
              isPlaying = event.target.getPlayerState() === YT.PlayerState.PLAYING;
              updateButtonIcon();

              // åªæœ‰åœ¨æ’­æ”¾å™¨å‡†å¤‡å°±ç»ªåæ‰æ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
              if (toggleBtn) { // ç¡®ä¿æŒ‰é’®å…ƒç´ å­˜åœ¨
                toggleBtn.addEventListener("click", (e) => {
                  e.stopPropagation();
                  if (isPlaying) {
                      player.pauseVideo();
                  } else {
                      player.playVideo();
                      player.unMute();
                      hasStartedMusic = true; // ç¡®ä¿æ­¤æ ‡å¿—åœ¨ç”¨æˆ·äº¤äº’åä¹Ÿè®¾ç½®ä¸ºtrue
                  }
                });
              }
            },
            onStateChange: (event) => {
                isPlaying = event.data === YT.PlayerState.PLAYING;
                updateButtonIcon();
            }
          }
        });
      }
  
      // YouTube API ä¼šåœ¨ API å‡†å¤‡å°±ç»ªæ—¶è°ƒç”¨æ­¤å‡½æ•°
      function onYouTubeIframeAPIReady() {
        initializeYouTubePlayer();
      }
  
      // æ£€æŸ¥ YouTube API æ˜¯å¦å·²åŠ è½½ï¼ˆä¾‹å¦‚ï¼Œä»ä¸Šä¸€ä¸ªé¡µé¢åŠ è½½ï¼‰
      // å¦‚æœå·²åŠ è½½ï¼Œåˆ™æ‰‹åŠ¨è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ã€‚
      if (window.YT && window.YT.Player) {
        onYouTubeIframeAPIReady();
      }
  
      // ä¿ç•™ window.showWish è¦†ç›–ï¼Œä½†ç¡®ä¿ player å­˜åœ¨ä¸”æœªå¼€å§‹æ’­æ”¾æ—¶æ‰è§¦å‘éŸ³ä¹
      const originalShowWish = window.showWish;
      window.showWish = function (index) {
        if (player && !hasStartedMusic) {
          player.playVideo();
          player.unMute();
          hasStartedMusic = true;
        }
        if (originalShowWish) {
          originalShowWish(index);
        }
      };
  
      function updateButtonIcon() {
        if (toggleBtn) { // ç¡®ä¿æŒ‰é’®å…ƒç´ å­˜åœ¨
          toggleBtn.textContent = isPlaying ? "ğŸµ" : "ğŸ”‡";
        }
      }
  </script>

</body>
</html>