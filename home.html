<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Home</title>
        <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/home.css">
    </head>
    <nav class="navbar">
        <div class="nav-left">ğŸ’š LUV U</div>
        <ul class="nav-right">
            <li><a href="home.html">Home</a></li>
            <li><a href="album.html">ğŸ“· Album</a></li>
            <li><a href="theatre.html?mode=all">ğŸ•°ï¸ Timeline</a></li>
            <li><a href="future.html">ğŸŒŸWish</a></li>
            <li><a href="about.html">ğŸ’¬ About</a></li>
            <li><a href="devlog.html">ğŸ§‘â€ğŸ’» DevLog</a></li>
        </ul>
    </nav>

    <main class="main-section">
        <div id="music-control" style="position: fixed; top: 90%; right: 30px; z-index: 100;">
            <button id="toggle-music" style="background: transparent; border: none; color: white; font-size: 2rem; cursor: pointer;">
              ğŸµ
            </button>
        </div>
          
        <div id="yt-music-player" style="display: none;"></div>
        <h2 class="together-title">æˆ‘ä»¬å·²ç»åœ¨ä¸€èµ·</h2>
        <div class="timer">
            <div><span id="days" class="red"></span><div>Days</div></div>
            <div><span id="hours" class="orange"></span><div>Hours</div></div>
            <div><span id="minutes" class="yellow"></span><div>Minutes</div></div>
            <div><span id="seconds" class="green"></span><div>Seconds</div></div>
        </div>
    </main>

    <section class="link-boxes">
        <a href="album.html" class="link-box">
            ğŸ“· <h3>Album</h3><p>ç•™ä½ä½ æˆ‘å›å¿†</p>
        </a>
        <a href="theatre.html?mode=all" class="link-box">
            ğŸ•°ï¸ <h3>Time Machine</h3><p>è®°å½•ä½ æˆ‘ç”Ÿæ´»</p>
        </a>
        <a href="future.html" class="link-box">
            ğŸ§¡ <h3>Wish Bottle</h3><p>è®©æˆ‘ä»¬æ†§æ†¬æœªæ¥</p>
        </a>
    </section>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 petryiy. All rights reserved.</p>
            <p>Built with ğŸ©· to Adonia.</p>
            <div class="social-icons">
            <a href="https://www.instagram.com/michaelzhang715/" target="_blank" class="social-icon">
                <i class="fab fa-instagram"></i>
            </a>
            <a href="www.linkedin.com/in/ruiqi-zhang-michael" target="_blank" class="social-icon">
                <i class="fab fa-linkedin-in"></i>
            </a>
            <a href="https://github.com/petryiy" target="_blank" class="social-icon">
                <i class="fab fa-github"></i>
            </a>
            </div>
        </div>
    </footer>

    <script src="scripts/home.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
      let player;
      let isPlaying = false;
      let hasStartedMusic = false;
      // è·å–æŒ‰é’®å¼•ç”¨ï¼Œç¡®ä¿åœ¨ DOMContentLoaded ä¹‹åå³å¯è®¿é—®
      const toggleBtn = document.getElementById("toggle-music");
  
      // ç”¨äºåˆå§‹åŒ– YouTube æ’­æ”¾å™¨çš„å‡½æ•°
      function initializeYouTubePlayer() {
        player = new YT.Player('yt-music-player', {
            videoId: 'KGbfyhKD6yw',
            playerVars: {
                autoplay: 1,
                loop: 1,
                controls: 0,
                playlist: 'KGbfyhKD6yw',
                modestbranding: 1,
                rel: 0
            },
            events: {
                onReady: (event) => {
                // æ’­æ”¾å™¨å‡†å¤‡å°±ç»ªåï¼Œå°è¯•æ’­æ”¾éŸ³ä¹å¹¶è®¾ç½®æŒ‰é’®ç›‘å¬å™¨
                if (!hasStartedMusic) {
                    event.target.playVideo();
                    event.target.unMute();
                    hasStartedMusic = true;
                }
                isPlaying = event.target.getPlayerState() === YT.PlayerState.PLAYING;
                updateButtonIcon();

                // åªæœ‰åœ¨æ’­æ”¾å™¨å‡†å¤‡å°±ç»ªåæ‰æ·»åŠ æŒ‰é’®ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
                if (toggleBtn) { // ç¡®ä¿æŒ‰é’®å…ƒç´ å­˜åœ¨
                    toggleBtn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    if (isPlaying) {
                        player.pauseVideo();
                    } else {
                        player.playVideo();
                        player.unMute();
                        hasStartedMusic = true; // ç¡®ä¿æ­¤æ ‡å¿—åœ¨ç”¨æˆ·äº¤äº’åä¹Ÿè®¾ç½®ä¸ºtrue
                    }
                    });
                }
                },
                onStateChange: (event) => {
                    isPlaying = event.data === YT.PlayerState.PLAYING;
                    updateButtonIcon();
                }
            }
        });
      }
  
      // YouTube API ä¼šåœ¨ API å‡†å¤‡å°±ç»ªæ—¶è°ƒç”¨æ­¤å‡½æ•°
      function onYouTubeIframeAPIReady() {
        initializeYouTubePlayer();
      }
  
      // æ£€æŸ¥ YouTube API æ˜¯å¦å·²åŠ è½½ï¼ˆä¾‹å¦‚ï¼Œä»ä¸Šä¸€ä¸ªé¡µé¢åŠ è½½ï¼‰
      // å¦‚æœå·²åŠ è½½ï¼Œåˆ™æ‰‹åŠ¨è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ã€‚
      if (window.YT && window.YT.Player) {
        onYouTubeIframeAPIReady();
      }
  
      // ä¿ç•™ window.showWish è¦†ç›–ï¼Œä½†ç¡®ä¿ player å­˜åœ¨ä¸”æœªå¼€å§‹æ’­æ”¾æ—¶æ‰è§¦å‘éŸ³ä¹
      const originalShowWish = window.showWish;
      window.showWish = function (index) {
        if (player && !hasStartedMusic) {
            player.playVideo();
            player.unMute();
            hasStartedMusic = true;
        }
        if (originalShowWish) {
            originalShowWish(index);
        }
      };
  
      function updateButtonIcon() {
        if (toggleBtn) { // ç¡®ä¿æŒ‰é’®å…ƒç´ å­˜åœ¨
            toggleBtn.textContent = isPlaying ? "ğŸµ" : "ğŸ”‡";
        }
      }
  </script>
</html>