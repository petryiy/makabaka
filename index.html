<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ç‹¬å±äºAdoniaå®å®çš„ç½‘ç«™</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="icon" href="images/favicon.png" type="image/png">
        <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Pacifico&display=swap" rel="stylesheet">
    </head>
    <body class="homepage">
        <div id="music-control">
            <div class="music-hint">ğŸµ å…ˆç‚¹æˆ‘å¼€å¯èƒŒæ™¯éŸ³ä¹ â†’</div>
            <button id="toggle-music">â–¶ï¸</button>
            <div id="yt-music-player"></div>
        </div>
        <div class="centered">
            <h1 class="fade-in delay-0 big-text">To My Love</h1>
            <p class="fade-in delay-1">åœ¨è¿™å¹³æ·¡çš„å²æœˆé‡Œï¼Œ</p>
            <p class="fade-in delay-2">ä½ å¦‚ç©¿è¿‡æˆ‘æŒ‡å°–çš„è´è¶ï¼Œ</p>
            <p class="fade-in delay-3">æŒ¯ç¿…æ—¶æ€èµ·æ•´ä¸ªæ˜¥å¤©çš„æ¶Ÿæ¼ªã€‚</p>
            <p class="fade-in delay-4">æˆ‘è§ä¼—äººçš†è‰æœ¨ï¼Œ å”¯ä½ æ˜¯é’å±±ã€‚</p>
            <p class="fade-in delay-5">ç”Ÿæ—¥å¿«ä¹ï¼Œ</p>
            <p class="fade-in delay-6">æ„¿ä½  - å¸¸æ¬¢æ„‰ã€çš†èƒœæ„ã€ä¸”é¡ºé‚ï¼</p>
            <a href="theatre.html" class="button fade-in delay-7">ç‚¹æˆ‘ç‚¹æˆ‘</a>
        </div>
    </body>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        let isPlaying = false;
        let hasUserInteracted = false;
    
        // è·å–æŒ‰é’®å¼•ç”¨
        const toggleMusicBtn = document.getElementById('toggle-music');
    
        // æ›´æ–°æŒ‰é’®å›¾æ ‡çš„å‡½æ•°
        function updateToggleButtonIcon() {
            if (toggleMusicBtn) {
                // å¦‚æœæ’­æ”¾å™¨å­˜åœ¨ä¸”æ­£åœ¨æ’­æ”¾ä¸”æœªé™éŸ³ï¼Œåˆ™æ˜¾ç¤ºæš‚åœå›¾æ ‡
                if (player && player.getPlayerState() === YT.PlayerState.PLAYING && !player.isMuted()) {
                    toggleMusicBtn.textContent = 'â¸ï¸'; // æ­£åœ¨æ’­æ”¾ä¸”æœ‰å£°éŸ³
                } else {
                    toggleMusicBtn.textContent = 'â–¶ï¸'; // æš‚åœã€åœæ­¢æˆ–é™éŸ³
                }
            }
        }
    
        // ç”¨äºåˆå§‹åŒ– YouTube æ’­æ”¾å™¨çš„å‡½æ•°
        function initializeYouTubePlayerPresent() {
            player = new YT.Player('yt-music-player', {
                videoId: 'NHuqhpRiu6o',
                playerVars: {
                    autoplay: 1,
                    controls: 0,
                    loop: 1,
                    playlist: 'NHuqhpRiu6o',
                    modestbranding: 1,
                    rel: 0
                },
                events: {
                    onReady: (event) => {
                        // æ’­æ”¾å™¨å‡†å¤‡å°±ç»ªåï¼Œç«‹å³é™éŸ³æ’­æ”¾å™¨ï¼Œå› ä¸ºæµè§ˆå™¨å¯èƒ½å·²ç»é™éŸ³äº†
                        event.target.mute();
                        isPlaying = false; // åˆå§‹çŠ¶æ€ä¸ºé™éŸ³ï¼Œæ‰€ä»¥è§†ä¸ºæœªæ’­æ”¾
                        updateToggleButtonIcon(); // æ›´æ–°æŒ‰é’®å›¾æ ‡ä¸ºâ€œæ’­æ”¾â€çŠ¶æ€
                        console.log("YouTube Player is ready and muted."); // è°ƒè¯•æ—¥å¿—
                    },
                    onStateChange: (event) => {
                        // æ ¹æ®æ’­æ”¾å™¨å®é™…çŠ¶æ€å’Œé™éŸ³çŠ¶æ€æ›´æ–° isPlaying
                        isPlaying = (event.data === YT.PlayerState.PLAYING && !player.isMuted());
                        updateToggleButtonIcon();
                    }
                }
            });
        }
    
        // YouTube API ä¼šåœ¨ API å‡†å¤‡å°±ç»ªæ—¶è°ƒç”¨æ­¤å‡½æ•°
        function onYouTubeIframeAPIReady() {
            initializeYouTubePlayerPresent();
        }
    
        // æ£€æŸ¥ YouTube API æ˜¯å¦å·²åŠ è½½ï¼ˆä¾‹å¦‚ï¼Œä»ä¸Šä¸€ä¸ªé¡µé¢åŠ è½½ï¼‰
        // å¦‚æœå·²åŠ è½½ï¼Œåˆ™æ‰‹åŠ¨è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ã€‚
        if (window.YT && window.YT.Player) {
            onYouTubeIframeAPIReady();
        }
    
        // å°†æŒ‰é’®ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ç§»åˆ°è¿™é‡Œï¼Œç¡®ä¿å®ƒåœ¨ DOM åŠ è½½åç«‹å³ç»‘å®š
        if (toggleMusicBtn) {
            toggleMusicBtn.addEventListener('click', () => {
                // åœ¨æ‰§è¡Œä»»ä½•æ’­æ”¾å™¨æ“ä½œä¹‹å‰ï¼Œæ£€æŸ¥ player å¯¹è±¡æ˜¯å¦å·²å®šä¹‰
                if (!player) {
                    console.warn("Player not yet initialized. Please wait or refresh.");
                    return; // å¦‚æœæ’­æ”¾å™¨æœªå°±ç»ªï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
                }
    
                if (!hasUserInteracted) {
                    // ç¬¬ä¸€æ¬¡äº¤äº’ï¼šå–æ¶ˆé™éŸ³å¹¶æ’­æ”¾
                    player.unMute();
                    player.playVideo();
                    hasUserInteracted = true;
                    isPlaying = true; // ç°åœ¨çœŸæ­£æ’­æ”¾å¹¶æœ‰å£°éŸ³äº†
                    console.log("First user interaction: Unmuted and playing."); // è°ƒè¯•æ—¥å¿—
                } else {
                    // åç»­äº¤äº’ï¼šåˆ‡æ¢æ’­æ”¾/æš‚åœ
                    if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                        player.pauseVideo();
                        isPlaying = false;
                        console.log("Pausing music."); // è°ƒè¯•æ—¥å¿—
                    } else {
                        player.playVideo();
                        isPlaying = true;
                        console.log("Playing music."); // è°ƒè¯•æ—¥å¿—
                    }
                }
                updateToggleButtonIcon(); // äº¤äº’åæ›´æ–°å›¾æ ‡
            });
        }
    </script>
</html>